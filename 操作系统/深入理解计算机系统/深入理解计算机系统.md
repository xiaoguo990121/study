# 第1章 计算机系统漫游
## 1.1 信息就是位 + 上下文
源程序实际上就是一个由值0和1组成的位（bit）序列，8个位被组织成一组，称为**字节。**每个字节表示程序中某个文本字符。

ASCII标准使用一个唯一的单字节大小的整数值来表示每个字符。

由ASCII字符构成的文件称为**文本文件，**所有其他文件都称为**二进制文件**

系统中所有的信息，包括磁盘文件、存储器中的程序、存储器中存放的用户数据以及网路上传送的数据，都是由一串位表示的。区分不同数据对象的唯一方法是我们读到这些数据对象时的上下文。比如，在不同的上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或者机器指令。

## 1.2 程序被其他程序翻译成不同的格式
![](https://cdn.nlark.com/yuque/0/2025/png/33729509/1735825117508-49a89009-3cfa-4aaf-9c08-64ef533b96ee.png)

:::tips
+ **预处理阶段**，预处理器根据以字符#开头的命令，修改原始的C程序
+ **编译阶段**，编译器将文本文件翻译成文本文件，它包含一个汇编语言程序
+ **汇编阶段**, 汇编器将汇编程序翻译成机器语言指令，将这些指令打包成一种叫做可重定位目标程序的格式，并将结果保存在目标文件中。目标文件是一个二进制文件。
+ **链接阶段，**链接器负责处理合并，包括系统函数，得到可执行目标文件。

:::

## 1.3 了解编译系统如何工作是最大有益处的
+ 优化程序性能
+ 理解链接时出现的错误
+ 避免安全漏洞

## 1.4 处理器读并解释存储在存储器中的指令
![](https://cdn.nlark.com/yuque/0/2025/png/33729509/1735825270716-9249a785-cc54-4f58-a28f-5168d0244c3d.png)

### 1.4.1 系统的硬件组成
1. **总线**，贯穿整个系统的是一组电子管道，称作总线，它携带信息字节并负责在各个部件间传递。通常总线被设计成传送定长的字节块，也就是**字**（word）字中的字节数（字长）是一个基本的系统参数，在各个系统中 的情况都不尽相同。
2. **I/O设备**，是系统与外部世界的联系通道。每个I/O设备都通过一个控制器或适配器与I/O总线相连。控制器和适配器之间的区别主要在于它们的封装方式。控制器是置于I/O设备本身的或者系统的主印制电路板上的芯片组，而适配器则是一块插在主板插槽上的卡。无论如何，它们的功能都是在I/O总线和I/O设备之间传递信息。
3. **主存**，从物理上说，由一组动态随机存取存储器（DRAM）芯片组成的。从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址，这些地址是从零开始的。
4. **处理器**，CPU是解释存储在主存中指令的引擎。处理器的核心是一个字长的存储设备（或寄存器），称为程序计数器（PC）。在任何时刻，PC都指向主存中的某条机器语言指令。处理器一直在不断地执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。

寄存器文件是一个小的存储设备，由一些1字长的寄存器组成，每个寄存器都有唯一的	名字。

+ 加载：把一个字节或者一个字从主存复制到寄存器，以覆盖寄存器原来的内容
+ 存储，把一个字节或者一个字从寄存器复制到主存的某个位置，以覆盖这个位置上原来的内容
+ 操作，把两个寄存器的内容复制到ALU（算术逻辑单元）,ALU对这两个字做算术操作，并将结果存放到一个寄存器中，以覆盖该寄存器中原来的内容
+ 跳转，从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖PC中原来的值

指令集结构描述的是每条机器代码指令的效果；而微体系结构描述的是处理器实际上如何实现的。

利用直接存储器存储（DMA）的技术，数据可以不通过处理器而直接从磁盘到达主存。

## 1.5 高速缓存至关重要
系统花费大量的时间把信息从一个地方挪到另一个地方。hello程序的机器指令最初是放在磁盘上的，当程序加载，被复制到主存，当处理器运行程序，从主存复制到处理器。系统设计者的一个主要目标就是使这些复制操作尽可能快的完成。

系统设计者采用更小、更快的存储设备，即高速缓存存储器，作为暂时的集结区域，用来存放处理器近期可能会需要的信息。

## 1.6 存储设备形成层次结构
![](https://cdn.nlark.com/yuque/0/2025/png/33729509/1735826712537-9f15a742-2ee0-4fdf-805c-48078549d0a3.png)

## 1.7 操作系统管理硬件
操作系统有两个基本功能：1）防止硬件被失控的应用程序滥用。2）向应用程序提供简单一致的机制来控制复杂而又通常大相径庭的低级硬件设备。

文件是对I/O设备的抽象表示，虚拟存储器是对主存和磁盘I/O设备的抽象表示，进程则是对处理器、主存和I/O设备的抽象表示。

1. **进程**，进程是操作系统对一个正在运行的程序的一种抽象。在一个系统上可以同时运行多个进程，而每个进程都好像在独占地使用硬件。操作系统实现交错执行的机制称为**上下文切换，**操作系统保持跟踪进程运行所需的所有状态信息。这种状态，也就是上下文，它包括许多信息，例如PC和寄存器文件的当前值，以及主存的内容。
2. **线程**，一个进程可以由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。
3. **虚拟存储器**，它为每个进程提供一个假象，即每个进程都在独占地使用主存。每个进程看到的是一致的存储器，称为虚拟地址空间。

![](https://cdn.nlark.com/yuque/0/2025/png/33729509/1735827284734-4d46fcc8-8b40-4dc1-bb43-668073fda21d.png)

+ **程序代码和数据**，对于所有进程来说，代码是从同一固定地址开始，紧接着的是和C全局变量相对应的数据位置。
+ **堆，**代码和数据区后紧随着的是运行时堆，代码和数据区是在进程一开始运行时就被规定了大小，与此不同，当调用如malloc和free这样的C标准库函数时，堆可以在运行时动态地扩展和收缩。
+ **共享库，**大约在地址空间的中间部分是一块用来存放像C标准库和数学库这样共享库的代码和数据区域，‘
+ **栈，**位于用户虚拟地址空间的顶部，编译器用它来实现函数调用。用户栈在程序执行期间可以动态地扩展和收缩。
+ **内核虚拟存储器，**内核总是驻留在内存中，是操作系统的一部分。
4. **文件**，文件就是字节序列，每个I/O设备，包括磁盘、键盘、显示器、甚至网络，都可以视为文件。系统中所有输入输出都是通过使用一小组称为Unix I/O的系统函数调用读写文件来实现的

## 1.8 系统之间利用网络通信
![](https://cdn.nlark.com/yuque/0/2025/png/33729509/1735827900449-924876e5-9b47-4c05-8d3b-2a9d952a21e0.png)

![](https://cdn.nlark.com/yuque/0/2025/png/33729509/1735828114690-b1c6bffb-3e76-45c2-b584-8d30f5eee4a2.png)

